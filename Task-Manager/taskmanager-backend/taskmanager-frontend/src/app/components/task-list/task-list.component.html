<!-- src/app/components/task-list/task-list.component.html -->

<div class="container mt-4">
  <!-- Header -->
  <div class="row mb-4">
    <div class="col text-center">
      <h1 class="display-4 fw-bold text-primary">ğŸ“‹ Task Manager</h1>
      <p class="text-muted">Organize your tasks efficiently</p>
    </div>
  </div>

  <!-- Action Bar -->
  <div class="row mb-4">
    <div class="col-md-4 mb-2">
      <button class="btn btn-primary w-100 btn-lg" (click)="openForm()">
        <i class="bi bi-plus-circle"></i> âœš Add New Task
      </button>
    </div>
    <div class="col-md-4 mb-2">
      <select 
        class="form-select form-select-lg" 
        [(ngModel)]="filterStatus" 
        (change)="onFilterChange()">
        <option value="ALL">ğŸ“Š All Tasks</option>
        <option value="TODO">ğŸ“ To Do</option>
        <option value="IN_PROGRESS">â³ In Progress</option>
        <option value="COMPLETED">âœ… Completed</option>
      </select>
    </div>
    <div class="col-md-4 mb-2">
      <input 
        type="text" 
        class="form-control form-control-lg" 
        placeholder="ğŸ” Search tasks..." 
        [(ngModel)]="searchKeyword"
        (input)="onSearch()">
    </div>
  </div>

  <!-- Task Form -->
  <app-task-form 
    *ngIf="showForm" 
    [task]="selectedTask"
    (taskSaved)="onTaskSaved()"
    (cancelled)="closeForm()">
  </app-task-form>

  <!-- Loading Spinner -->
  <div *ngIf="isLoading" class="text-center my-5">
    <div class="spinner-border text-primary" role="status">
      <span class="visually-hidden">Loading...</span>
    </div>
    <p class="mt-3 text-muted">Loading tasks...</p>
  </div>

  <!-- Empty State -->
  <div class="row" *ngIf="!isLoading && filteredTasks.length === 0">
    <div class="col-12">
      <div class="alert alert-info text-center shadow-sm">
        <h4>ğŸ“­ No tasks found</h4>
        <p class="mb-0">
          <span *ngIf="searchKeyword || filterStatus !== 'ALL'">
            Try adjusting your filters or search terms.
          </span>
          <span *ngIf="!searchKeyword && filterStatus === 'ALL'">
            Create your first task to get started!
          </span>
        </p>
      </div>
    </div>
  </div>

  <!-- Task Cards Grid -->
  <div class="row" *ngIf="!isLoading">
    <div class="col-md-6 col-lg-4 mb-4" *ngFor="let task of filteredTasks">
      <div class="card h-100 shadow-sm task-card">
        <div class="card-body d-flex flex-column">
          <!-- Task Header -->
          <div class="d-flex justify-content-between align-items-start mb-3">
            <h5 class="card-title mb-0 flex-grow-1">{{ task.title }}</h5>
            <span [class]="getPriorityClass(task.priority)" class="ms-2">
              {{ task.priority }}
            </span>
          </div>
          
          <!-- Task Description -->
          <p class="card-text text-muted mb-3 flex-grow-1">
            {{ task.description || 'No description provided' }}
          </p>
          
          <!-- Status Badge -->
          <div class="mb-3">
            <span [class]="getStatusClass(task.status)" class="fs-6">
              {{ getStatusText(task.status) }}
            </span>
          </div>

          <!-- Due Date -->
          <div class="mb-3" *ngIf="task.dueDate">
            <small class="text-muted">
              ğŸ“… Due: {{ task.dueDate | date:'MMM d, y, h:mm a' }}
            </small>
          </div>

          <!-- Status Update Buttons -->
          <div class="btn-group mb-3" role="group">
            <button 
              type="button"
              class="btn btn-sm btn-outline-secondary"
              (click)="updateStatus(task, TaskStatus.TODO)"
              [disabled]="task.status === TaskStatus.TODO"
              title="Mark as To Do">
              ğŸ“
            </button>
            <button 
              type="button"
              class="btn btn-sm btn-outline-primary"
              (click)="updateStatus(task, TaskStatus.IN_PROGRESS)"
              [disabled]="task.status === TaskStatus.IN_PROGRESS"
              title="Mark as In Progress">
              â³
            </button>
            <button 
              type="button"
              class="btn btn-sm btn-outline-success"
              (click)="updateStatus(task, TaskStatus.COMPLETED)"
              [disabled]="task.status === TaskStatus.COMPLETED"
              title="Mark as Completed">
              âœ…
            </button>
          </div>

          <!-- Action Buttons -->
          <div class="d-grid gap-2">
            <button 
              class="btn btn-warning btn-sm" 
              (click)="openForm(task)">
              âœï¸ Edit Task
            </button>
            <button 
              class="btn btn-danger btn-sm" 
              (click)="deleteTask(task.id)">
              ğŸ—‘ï¸ Delete Task
            </button>
          </div>

          <!-- Timestamp -->
          <div class="mt-3 pt-2 border-top">
            <small class="text-muted">
              Created: {{ task.createdAt | date:'short' }}
            </small>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Task Count -->
  <div class="row mt-4" *ngIf="!isLoading && filteredTasks.length > 0">
    <div class="col text-center">
      <p class="text-muted">
        Showing {{ filteredTasks.length }} of {{ tasks.length }} tasks
      </p>
    </div>
  </div>
</div>